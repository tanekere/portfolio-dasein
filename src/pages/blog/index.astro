---
import { getCollection } from 'astro:content';
import Card from '../../components/Card.astro';
import PageLayout from '../../layouts/PageLayout.astro';

import { getSite } from '../../utils/consts';
import { slugify, withBase } from '../../utils/slugify';

const posts = (await getCollection('blog', ({ data }) => !data.draft)).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
const [featured, ...rest] = posts;
const site = await getSite();
---

<PageLayout title={site.title} description="Blog">
	<section class="content-shell py-12 space-y-8">
		{featured && (
			<div class="grid grid-cols-1">
				<Card
					title={featured.data.title}
					href={withBase(`/blog/${featured.id}/`)}
					description={featured.data.description}
					date={featured.data.pubDate}
					image={featured.data.heroImage}
					imageAlt={featured.data.title}
					variant="post"
				>
					{featured.data.tags.length > 0 && (
						<div class="flex flex-wrap gap-2 pt-1 text-sm text-muted">
							{featured.data.tags.map((tag) => (
								<a class="inline-flex items-center gap-2 rounded-full border border-[color:var(--color-border)] bg-[color:var(--color-surface)] px-3 py-1 hover:text-ink" href={withBase(`/tags/${slugify(tag)}/`)}>
									{tag}
								</a>
							))}
						</div>
					)}
				</Card>
			</div>
		)}

		{rest.length > 0 && (
			<div class="grid grid-cols-1 md:grid-cols-2 gap-6 lg:gap-8">
				{rest.map((post) => (
					<Card
						title={post.data.title}
						href={withBase(`/blog/${post.id}/`)}
						description={post.data.description}
						date={post.data.pubDate}
						image={post.data.heroImage}
						imageAlt={post.data.title}
						variant="post"
					>
						{post.data.tags.length > 0 && (
							<div class="flex flex-wrap gap-2 pt-1 text-sm text-muted">
								{post.data.tags.map((tag) => (
									<a class="inline-flex items-center gap-2 rounded-full border border-[color:var(--color-border)] bg-[color-mix(in_oklab,var(--color-surface)_95%,transparent)] px-3 py-1 hover:text-ink" href={withBase(`/tags/${slugify(tag)}/`)}>
										{tag}
									</a>
								))}
							</div>
						)}
					</Card>
				))}
			</div>
		)}
	</section>
</PageLayout>
